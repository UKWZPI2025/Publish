<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Logowanie | Gabinet Ortodontyczny</title>
  <link rel="stylesheet" href="style/style_log_rej.css" />
</head>
<body>
  <div class="container">
    <h1>Logowanie pacjenta</h1>
    <form action="/login" method="post" class="form-box">

      <p><br></br></p>
      <p><br></br></p>

      <label for="pesel">PESEL</label>
      <input type="text" id="pesel" name="pesel" required>

      <label for="haslo">Hasło</label>
      <input type="password" id="haslo" name="haslo" required>

      <button type="submit">Zaloguj się</button>
    </form>
    <p><a href="rejestracja.html">Nie masz konta? Zarejestruj się</a></p>
  </div>
</body>

<script>
  document.querySelector(".form-box").addEventListener("submit", function (e) {e.preventDefault(); //usuniecie mozliwosci, zeby wyslac rejestracyjny formularz bez zadnych wpisow
  
    const pesel = document.getElementById("pesel").value.trim();
      const haslo = document.getElementById("haslo").value;

      fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pesel, haslo })
      })
      .then(res => res.json())
      .then(info => {
        console.log("Odpowiedź serwera:", info);
      if (info.success) {
        localStorage.setItem("userId", info.idUzytkownika);
        localStorage.setItem("imie",     info.imie);
        localStorage.setItem("nazwisko", info.nazwisko);
        localStorage.setItem("email",    info.email);
        localStorage.setItem("telefon",  info.telefon);
        localStorage.setItem("rola", info.rola);
        localStorage.setItem("token", info.token);

        if (info.rola === "recepcjonistka") {
          window.location.href = "index_recepcjonista.html";
        } else if (info.rola === "dentysta") {
          window.location.href = "index_dentysta.html";
        } else if (info.rola === "admin") {
          window.location.href = "index_admin.html";
        } else {
          window.location.href = "wizyty_uzytkownik.html"; // pacjent
        }
      }
     else {
          alert("Błąd: " + info.message);
        }
      })


      .catch(err => {
        console.error("Błąd połączenia:", err);
        alert("Problem z połączeniem z serwerem.");
      });
    });
  </script>


</html>
