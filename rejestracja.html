<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Rejestracja | Gabinet Ortodontyczny</title>
  <link rel="stylesheet" href="style/style_log_rej.css" />
</head>
<body>
  <div class="container">
    <h1>Rejestracja pacjenta</h1>
    <form action="/rejestracja" method="post" class="form-box">

      <p><br></br></p>
      <p><br></br></p>

      <label for="imie">Imię</label>
      <input type="text" id="imie" name="imie" required>

      <label for="drugieImie">Drugie imię</label>
      <input type="text" id="drugieImie" name="drugieImie">

      <label for="nazwisko">Nazwisko</label>
      <input type="text" id="nazwisko" name="nazwisko" required>

      <label for="adresEmail">Adres email</label>
      <input type="email" id="adresEmail" name="adresEmail" required>

      <label for="haslo">Hasło</label>
      <input type="password" id="haslo" name="haslo" required>

      <label for="dataUr">Data urodzenia</label>
      <input type="date" id="dataUr" name="dataUr" required>

      <label for="nrTelefonu">Numer telefonu</label>
      <input type="tel" id="nrTelefonu" name="nrTelefonu" required>

      <label for="pesel">PESEL</label>
      <input type="text" id="pesel" name="pesel" required>

      <button type="submit">Zarejestruj się</button>
    </form>
    <p><a href="logowanie.html">Masz już konto? Zaloguj się</a></p>
  </div>
</body>

<script>
  document.querySelector(".form-box").addEventListener("submit", function (e) {e.preventDefault(); //usuniecie mozliwosci, zeby wyslac rejestracyjny formularz bez zadnych wpisow
  
      const imie = document.getElementById("imie").value;
      const drugieImie = document.getElementById("drugieImie").value;
      const nazwisko = document.getElementById("nazwisko").value;
      const adresEmail = document.getElementById("adresEmail").value;
      const haslo = document.getElementById("haslo").value;
      const dataUr = document.getElementById("dataUr").value;
      const nrTelefonu = document.getElementById("nrTelefonu").value;
      const pesel = document.getElementById("pesel").value;
  
      const dane = {
          imie: imie,
          drugieImie: drugieImie,
          nazwisko: nazwisko,
          adresEmail: adresEmail,
          haslo: haslo,
          dataUr: dataUr,
          nrTelefonu: nrTelefonu,
          pesel: pesel,
          //pesel: pesel.toString(),
          rola: "pacjent" 
      };
  
      fetch("/rejestracja", {
          method: "POST",
          headers: {
              "Content-Type": "application/json"
          },
          body: JSON.stringify(dane)
      })
      .then(res => res.json())
      .then(info => {
          if (info.status === 200) {
              localStorage.setItem("userId", info.idUzytkownika);
              localStorage.setItem("imie",     info.imie);
              localStorage.setItem("nazwisko", info.nazwisko);
              localStorage.setItem("email",    info.email);
              localStorage.setItem("telefon",  info.telefon);

              console.log("Rejestracja konta udana");
              window.location.href = "index_uzytkownik.html";
          } else {
              console.error("Błąd podczas rejestracji:", info.message);
              alert("Błąd: " + info.message);
          }
      })
      .catch(err => {
          console.error("Błąd połączenia:", err);
          alert("Wystąpił problem z połączeniem z serwerem.");
      });
  });
  </script>


</html>
